generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  firstName String
  lastName  String
  role String @default("WORKER")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  sites      Site[]
  operations SiteOperation[]
  documents  Document[]

  @@map("users")
}



model Site {
  id          String   @id @default(cuid())
  name        String
  location    String
  address     String
  postcode    String
  startDate   DateTime
  endDate     DateTime?
  status String @default("ACTIVE")
  managerId   String
  manager     User     @relation(fields: [managerId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  operations  SiteOperation[]
  documents   Document[]
  checklists  Checklist[]

  @@map("sites")
}



model SiteOperation {
  id          String   @id @default(cuid())
  siteId      String
  site        Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)
  operationType String
  description String
  startTime   DateTime
  endTime     DateTime?
  duration    Int?
  workersCount Int
  status String @default("IN_PROGRESS")
  recordedBy  String
  user        User     @relation(fields: [recordedBy], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("site_operations")
}



model Checklist {
  id        String   @id @default(cuid())
  siteId    String
  site      Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)
  name      String
  items     ChecklistItem[]
  status String @default("PENDING")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("checklists")
}



model ChecklistItem {
  id          String   @id @default(cuid())
  checklistId String
  checklist   Checklist @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  description String
  completed   Boolean   @default(false)
  completedAt DateTime?

  @@map("checklist_items")
}

model Document {
  id        String   @id @default(cuid())
  siteId    String
  site      Site     @relation(fields: [siteId], references: [id], onDelete: Cascade)
  uploadedBy String
  user      User     @relation(fields: [uploadedBy], references: [id])
  fileName  String
  fileUrl   String
  fileSize  Int
  fileType  String
  docType String @default("OTHER")
  createdAt DateTime @default(now())

  @@map("documents")
}


